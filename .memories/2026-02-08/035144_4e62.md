---
git:
  branch: main
  commit: 08679c9
  dirty: true
  files_changed:
  - crates/julie-extractors/src/cpp/declarations.rs
  - crates/julie-extractors/src/cpp/mod.rs
  - crates/julie-extractors/src/dart/mod.rs
  - crates/julie-extractors/src/go/signatures.rs
  - crates/julie-extractors/src/go/types.rs
  - crates/julie-extractors/src/kotlin/helpers.rs
  - crates/julie-extractors/src/kotlin/mod.rs
  - crates/julie-extractors/src/kotlin/types.rs
  - crates/julie-extractors/src/tests/cpp/types.rs
  - crates/julie-extractors/src/tests/go/mod.rs
  - crates/julie-extractors/src/tests/zig/extractor.rs
  - crates/julie-extractors/src/tests/zig/mod.rs
  - crates/julie-extractors/src/zig/functions.rs
  - crates/julie-extractors/src/zig/mod.rs
  - crates/julie-extractors/src/zig/relationships.rs
  - crates/julie-extractors/src/zig/type_inference.rs
  - crates/julie-extractors/src/zig/types.rs
  - crates/julie-extractors/src/zig/variables.rs
id: checkpoint_69880850_acc5c6
tags:
- dart
- extractor
- bugfix
- refactor
timestamp: 1770522704
type: checkpoint
---

## Dart Extractor Fix - All 3 Issues Resolved

### Issue 1 (P0 CRITICAL): Removed Hardcoded ERROR Handler
- Deleted `extract_enum_constants_from_error`, `extract_enum_constants_from_text`, `extract_enum_constants_from_error_recursive`
- These contained hardcoded test values (`"green"`, `"blue"`, `"Color"`, `"Blue"`) that would fail on real Dart code
- Replaced with generic enum recovery:
  - `find_enum_context_parent()` - walks previous siblings to find `enum_declaration`
  - `recover_enum_symbols_from_error()` - builds already-extracted set, delegates to recursive
  - `recover_from_node_recursive()` - extracts `member_access` -> EnumMember, `const_object_expression` -> Constructor
- Handles both `ERROR` and `expression_statement` nodes (harper-tree-sitter-dart splits enhanced enum bodies across siblings)
- Dedup: uses `HashSet<String>` for names, checks specifically for Constructor kind to avoid blocking on same-name Enum

### Issue 2 (P2): Split mod.rs Below 500 Lines
- `mod.rs`: 706 -> 384 lines
- New `identifiers.rs`: 84 lines (extracted identifier walking/extraction)
- New `pending_calls.rs`: 168 lines (extracted cross-file call detection)
- All files well under 500-line limit

### Issue 3 (P2): Thread-local Cache Assessment
- `DART_CONTENT_CACHE` in `helpers.rs` is still needed
- ~70+ call sites use `get_node_text()` from helpers, including helper functions that don't receive `&BaseExtractor`
- The cache is functionally correct: thread-local, set once per file, no race conditions
- Eliminating it would require threading `base` through all helper functions - large refactor with no functional benefit

### Test Results
- 26/26 dart tests pass
- 1126/1126 full extractor suite passes (0 failures, 2 ignored)
