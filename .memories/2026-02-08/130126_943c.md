---
id: mem_59eaff28a0070e35
timestamp: 1770577286246
tags:
  - r-extractor
  - identifiers
  - relationships
  - synthetic-ids
  - scope-resolution
  - quality-improvement
git:
  branch: main
  commit: 3bef302
  dirty: true
  filesChanged:
    - memories/plans/plan_extractor-round-3-quality-improvements.json
    - TODO.md
    - crates/julie-extractors/src/cpp/declarations.rs
    - crates/julie-extractors/src/cpp/mod.rs
    - crates/julie-extractors/src/ruby/calls.rs
    - crates/julie-extractors/src/ruby/helpers.rs
    - crates/julie-extractors/src/ruby/mod.rs
    - crates/julie-extractors/src/tests/cpp/mod.rs
    - crates/julie-extractors/src/tests/ruby/mod.rs
    - .memories/2025-11-20/213206_ad5b.json
    - .memories/2025-11-20/214303_13b2.json
    - .memories/2025-11-20/230017_4d13.json
    - .memories/2025-11-21/
    - .memories/2025-11-22/
    - .memories/2025-11-25/
    - .memories/2025-11-26/
    - .memories/plans/plan_round-5-extractor-quality-bb-a-grade-push.json
    - .memories/plans/plan_tool-specific-lean-output-formats.json
    - crates/julie-extractors/src/tests/cpp/declarations.rs
    - crates/julie-extractors/src/tests/ruby/struct_and_module_function.rs
    - docs/plans/2026-02-08-extractor-round5-quality.md
---
## R Extractor: Fixed Identifier Scope Resolution + Removed Synthetic Relationship IDs

### What was done
- **Fixed `find_containing_symbol_id`** in `crates/julie-extractors/src/r/identifiers.rs`
  - Replaced broken line-number matching with `BaseExtractor::find_containing_symbol()` (byte-range containment)
  - Now follows the standard pattern used by Rust, Kotlin, and other extractors
  - Filters symbols to only the current file before matching (prevents cross-file false matches)

- **Removed synthetic IDs** from `crates/julie-extractors/src/r/relationships.rs`
  - Eliminated `builtin_` prefix IDs (e.g., `builtin_print`, `builtin_mean`) - built-in R functions are now silently dropped
  - Eliminated `piped_` prefix IDs (e.g., `piped_filter`) - piped calls to non-local functions now create `PendingRelationship`
  - Eliminated `member_` prefix IDs (e.g., `member_name`) - member access now creates `PendingRelationship`
  - Local function calls (both direct and piped) still create resolved `Relationship` records

### Tests added (9 new tests)
- 4 identifier scope tests: inside function, scoping distinction, member access scope, variable ref scope
- 5 synthetic ID tests: no builtin_ IDs, no piped_ IDs, no member_ IDs, builtins create pending, piped creates pending

### Key decisions
- Built-in R functions are **silently dropped** (no Relationship AND no PendingRelationship) - they're known base R functions
- Non-builtin, non-local functions create **PendingRelationship** for cross-file resolution
- Member access always creates **PendingRelationship** (targets are dynamic/unresolvable locally)

### Files changed
- `crates/julie-extractors/src/r/identifiers.rs` (196 lines)
- `crates/julie-extractors/src/r/relationships.rs` (283 lines)
- `crates/julie-extractors/src/tests/r/identifiers.rs` (457 lines)
- `crates/julie-extractors/src/tests/r/mod.rs` (86 lines) - added `extract_all` helper
- `crates/julie-extractors/src/tests/r/relationships.rs` (382 lines)

### Commit
`fix(r): fix identifier scope resolution, remove synthetic relationship IDs`
