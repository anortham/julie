---
git:
  branch: main
  commit: 08679c9
  dirty: true
  files_changed:
  - TODO.md
id: checkpoint_6987f834_4af7d8
tags:
- wal
- sqlite
- verified
- disk-usage
timestamp: 1770518580
type: checkpoint
---

## WAL Fix Verified — 0 Bytes After Fresh Index

### Results
- **Before fix**: `symbols.db` 74MB + `symbols.db-wal` 75MB = **149MB total**
- **After fix**: `symbols.db` 77MB + `symbols.db-wal` 0 bytes = **77MB total**
- **Savings**: ~49% disk reduction

### Root Cause Confirmed
The individual `bulk_store_*` methods (symbols, files, identifiers, types) had checkpoint calls but were **not used** during normal indexing. The actual path — `incremental_update_atomic` + `bulk_store_relationships` — had zero checkpoints.

### Fix Applied
- `incremental_update_atomic`: added `self.checkpoint_wal()` (TRUNCATE) after commit
- `bulk_store_relationships`: added `self.checkpoint_wal()` (TRUNCATE) after commit
- Both use `info!`/`warn!` logging (visible in production logs)

### Two commits
- `15eba98` — Fixed individual bulk_store_* methods (RESTART → TRUNCATE)
- `08679c9` — Fixed actual indexing path (added missing checkpoints)
