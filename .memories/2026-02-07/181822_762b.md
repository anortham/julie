---
git:
  branch: main
  commit: 6d9dc78
  dirty: true
  files_changed:
  - src/database/symbols/queries.rs
  - src/handler.rs
  - src/tests/integration/real_world_validation.rs
  - src/tests/integration/tracing.rs
  - src/tests/mod.rs
  - src/tests/tools/ast_symbol_finder.rs
  - src/tests/tools/editing/edit_lines.rs
  - src/tests/tools/editing/edit_lines_validation.rs
  - src/tests/tools/editing/fuzzy_replace.rs
  - src/tests/tools/editing/mod.rs
  - src/tests/tools/exploration/fast_explore.rs
  - src/tests/tools/exploration/fast_explore_types.rs
  - src/tests/tools/exploration/find_logic.rs
  - src/tests/tools/exploration/mod.rs
  - src/tests/tools/navigation/mod.rs
  - src/tests/tools/refactoring/edit_symbol.rs
  - src/tests/tools/refactoring/extract_to_file_tests.rs
  - src/tests/tools/refactoring/insert_relative_tests.rs
  - src/tests/tools/refactoring/mod.rs
  - src/tests/tools/refactoring/replace_symbol_body_tests.rs
  - src/tests/tools/refactoring/scope_test.rs
  - src/tests/tools/refactoring/smart_refactor.rs
  - src/tests/tools/refactoring/smart_refactor_control.rs
  - src/tests/tools/search/mod.rs
  - src/tests/tools/trace_call_path/comprehensive.rs
  - src/tests/tools/trace_call_path/mod.rs
  - src/tests/tools/trace_call_path/workspace_isolation.rs
  - src/tools/ast_symbol_finder.rs
  - src/tools/edit_lines.rs
  - src/tools/exploration/fast_explore/mod.rs
  - src/tools/exploration/find_logic/mod.rs
  - src/tools/exploration/find_logic/search.rs
  - src/tools/exploration/mod.rs
  - src/tools/exploration/types.rs
  - src/tools/fuzzy_replace.rs
  - src/tools/fuzzy_replace_algorithm.rs
  - src/tools/mod.rs
  - src/tools/navigation/fast_goto.rs
  - src/tools/navigation/formatting.rs
  - src/tools/navigation/mod.rs
  - src/tools/navigation/reference_workspace.rs
  - src/tools/navigation/types.rs
  - src/tools/refactoring/helpers.rs
  - src/tools/refactoring/indentation.rs
  - src/tools/refactoring/mod.rs
  - src/tools/refactoring/operations.rs
  - src/tools/refactoring/types.rs
  - src/tools/search/formatting.rs
  - src/tools/search/mod.rs
  - src/tools/search/text_search.rs
  - src/tools/trace_call_path/cross_language.rs
  - src/tools/trace_call_path/formatting.rs
  - src/tools/trace_call_path/mod.rs
  - src/tools/trace_call_path/tracing.rs
  - src/tools/trace_call_path/types.rs
id: checkpoint_698781ee_c3e69f
tags:
- toolset-redesign
- phase-3
- deep_dive
- progressive-depth
- kind-aware
timestamp: 1770488302
type: checkpoint
---

## Toolset Redesign — Phase 3 Complete: deep_dive Tool

### New Tool: `deep_dive`
Progressive-depth, kind-aware symbol investigation. Returns definition, references, children, and type info in a single call — tailored to the symbol's kind.

### Architecture (3 files)
- **`src/tools/deep_dive/mod.rs`** — Tool struct (`DeepDiveTool`) with `symbol`, `depth`, `context_file`, `workspace` params
  - `call_tool()` with `spawn_blocking` for SQLite work
  - `ref_caps()`: overview=(10,10), context=(15,15), full=(500,500)
- **`src/tools/deep_dive/data.rs`** — Data gathering from SQLite
  - `SymbolContext` struct: symbol, incoming/outgoing `Vec<RefEntry>` with totals, children, implementations
  - `find_symbol()`: name lookup with import filtering + context_file disambiguation
  - `build_symbol_context()`: orchestrates relationship queries, children, implementations, depth-gated enrichment
  - `enrich_refs()`: batch symbol lookup via `get_symbols_by_ids`
- **`src/tools/deep_dive/formatting.rs`** — Kind-aware text output
  - Dispatches by `SymbolKind` to: `format_callable`, `format_trait_or_interface`, `format_class_or_struct`, `format_enum`, `format_module`, `format_generic`
  - `format_ref_section()`: overview=name, context=signature, full=body (up to 10 lines)
  - `format_body()`: overview=none, context=30 lines, full=100 lines

### Database Support
- Added `get_children_by_parent_id()` to `database/symbols/queries.rs` (uses `SYMBOL_COLUMNS_LIGHTWEIGHT`)

### Registration
- Handler: `#[tool]` method in `handler.rs` with read_only=true, idempotent=true
- Module: `pub mod deep_dive` + `pub use deep_dive::DeepDiveTool` in `tools/mod.rs`

### Tests (24 new)
- **14 formatting tests**: header display, callable (callers/callees/body gating), trait (methods/implementations), struct (fields/methods), enum (members), module (exports), generic (references), truncation indicator, depth-gated signatures, full-depth ref bodies
- **10 data layer tests**: find_symbol (by name, import filtering, file disambiguation, not found), build_symbol_context (incoming/outgoing relationships, enrichment at context depth, children, non-container has no children, reference capping)

### Results
- **Build**: 0 errors, 0 warnings
- **Tests**: 636 passed, 0 failed, 24 ignored (612 existing + 24 new)
