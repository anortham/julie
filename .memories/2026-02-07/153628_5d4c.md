---
git:
  branch: main
  commit: d0edc3b
  dirty: true
  files_changed:
  - crates/julie-extractors/src/razor/html.rs
  - crates/julie-extractors/src/razor/mod.rs
  - crates/julie-extractors/src/razor/relationships.rs
  - crates/julie-extractors/src/tests/razor/mod.rs
id: checkpoint_69875bfc_e0b5f2
tags:
- razor
- blazor
- html-filtering
- tree-sitter
- parser-limitation
timestamp: 1770478588
type: checkpoint
---

## Razor Extractor Overhaul — HTML Noise Filtering

### Problem
Razor/Blazor extractor treated every HTML tag as a Class symbol. For a 26-line MainLayout.razor, `get_symbols` returned 10 symbols — ALL HTML elements (`div`, `p`, `h5`). PascalCase Blazor components were drowned in noise.

### Changes

#### 1. HTML Element Filtering (`razor/mod.rs`)
- Added `is_blazor_component()` — checks if tag starts with uppercase ASCII
- Changed `"html_element" | "element"` arm to only create symbols for PascalCase tags
- Preserved `create_external_component_symbols_if_needed()` as fallback for parser limitations
- Preserved `extract_binding_attributes_from_element()` for all elements

#### 2. Metadata Type Fix (`razor/html.rs`)
- Changed `extract_html_element()` metadata type from `"html-element"` to `"blazor-component"`
- Since this function is now only called for PascalCase tags, all its symbols ARE components

#### 3. Relationship Recognition (`razor/relationships.rs`)
- Added `"blazor-component"` to `is_component_symbol()` matcher
- Fixed `extract_element_relationships()` from-symbol lookup to prevent self-referencing:
  - Finds target component first, then finds a different from-symbol (tries @page → Module → Class)
  - Prevents `AppHeader -> AppHeader Uses` self-references

#### 4. Test Updates
- Updated `test_extract_html_comment_from_razor_html` — now asserts lowercase elements are NOT extracted
- Added `blazor_extraction_tests` module with 7 new tests (inherits, @code properties, lifecycle methods, HTML filtering, Blazor components, inject)
- All 26 Razor tests pass, 1124 extractors tests pass, 758 full lib tests pass

### Key Discovery: tree-sitter-razor Parser Limitation
- `@Body` followed by `<AppFooter>` gets misparsed as `Body < AppFooter` (C# comparison)
- The `<` is ambiguous: HTML tag opener vs C# less-than operator
- `create_external_component_symbols_if_needed()` exists as a regex-based fallback for this exact scenario
- It scans parent element text for `<[A-Z][A-Za-z0-9]*` and creates "external-component" symbols

### Files Changed
- `crates/julie-extractors/src/razor/mod.rs` — `visit_node`, `is_blazor_component()`
- `crates/julie-extractors/src/razor/html.rs` — metadata type `"blazor-component"`
- `crates/julie-extractors/src/razor/relationships.rs` — `is_component_symbol()`, `extract_element_relationships()`
- `crates/julie-extractors/src/tests/razor/mod.rs` — updated + new tests
