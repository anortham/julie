---
git:
  branch: main
  commit: 40ac5d3
  dirty: true
  files_changed:
  - .memories/plans/plan_phase-3-priority-1-fast-search-improvements.json
id: checkpoint_698566b1_beabf7
tags:
- agent-teams
- audit
- get_symbols
- find_logic
- overflow
- phase3
timestamp: 1770350257
type: checkpoint
---

First agent team experiment complete — 3 parallel investigations ran successfully.

## Findings Summary:

### 1. get_symbols Audit (Phase 3 Priority 3)
Top optimizations identified:
- HIGH: Over-fetching all 20 DB columns (metadata JSON deserialization wasted when mode=structure)
- HIGH: Triple-clone in filter pipeline (3 full Symbol vec clones, should be index-based single clone)
- MEDIUM: TOON formatting clones everything again + SymbolKind Debug vs Display inconsistency
- Code path: handler.rs:385 → tools/symbols/mod.rs:86 → primary.rs:18 → queries.rs:84 → filtering.rs → body_extraction.rs → formatting.rs

### 2. test_tier2_finds_controller_pattern Root Cause
BUG in src/tools/workspace/indexing/index.rs ~line 34:
  `let is_primary_workspace = workspace_path == std::env::current_dir()`
In tests (and any workspace != CWD), this is false → indexing goes through reference workspace path → creates disconnected SearchIndex → commit silently fails → symbols missing from search.
FIX: Compare against handler's workspace root, not current_dir.

### 3. Subtract-with-overflow in creation_methods.rs:196-197
BUG in crates/julie-extractors/src/base/creation_methods.rs:196-197 in find_containing_symbol():
  `(a.end_column - a.start_column)` underflows because columns refer to different lines.
Pre-existing since 2025-11-02. Affects all 15 language extractors that call find_containing_symbol.
FIX: Replace with `a.end_byte - a.start_byte` (always valid, more accurate).
