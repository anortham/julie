---
git:
  branch: main
  commit: 7297133
  dirty: true
  files_changed:
  - .memories/plans/plan_replace-fts5-with-tantivy-codetokenizer.json
  - crates/julie-extractors/src/factory.rs
  - crates/julie-extractors/src/gdscript/mod.rs
  - crates/julie-extractors/src/manager.rs
  - crates/julie-extractors/src/ruby/mod.rs
  - crates/julie-extractors/src/tests/gdscript/mod.rs
  - crates/julie-extractors/src/tests/ruby/mod.rs
  - src/search/index.rs
  - src/search/query.rs
  - src/tests/integration/watcher.rs
  - src/tests/integration/watcher_handlers.rs
  - src/tests/mod.rs
  - src/tests/tools/search/tantivy_index_tests.rs
  - src/tools/workspace/indexing/mod.rs
  - src/tools/workspace/indexing/processor.rs
  - src/tools/workspace/mod.rs
  - src/watcher/handlers.rs
  - src/watcher/mod.rs
  - src/workspace/mod.rs
id: checkpoint_69854d6b_88d7c3
tags:
- search
- fast_search
- output_format
- token_efficiency
- scoring
timestamp: 1770343787
type: checkpoint
---

Audit of fast_search output format and token efficiency

**Critical Findings:**
1. code_context is NEVER populated in fast_search results - parameter exists but is completely unused
2. LEAN format is 80% smaller than JSON but isn't used by default in AUTO mode
3. Scoring is Tantivy BM25 (5x name boost) + post-search important_patterns boost (1.5x)
4. Each Symbol has confidence=Tantivy score; tool-level confidence calculated from name match ratio
5. Extraction confidence is ignored; search uses only Tantivy BM25
6. Reference workspaces route through line_mode.rs, not primary Tantivy search

**Output Formats:**
- LEAN: 80% smaller than JSON, grep-style (no insights/next_actions)
- TOON: 60% smaller than JSON, binary encoded (includes all fields)
- JSON: Full metadata with insights + next_actions + tool metadata
- AUTO: <10 results→JSON, ≥10 results→TOON (never LEAN by default!)

**Token Efficiency Issues:**
- code_context=None always (could save ~5-10 tokens per result if populated)
- LEAN format never selected in AUTO mode despite huge savings
- Many optional fields serialized even when None
- No way to request LEAN format in AUTO mode

**Post-search Boosts:**
- important_patterns_boost: 1.5x for matching language-specific patterns (pub fn, export, etc)
- Only applied if language_configs loaded
- Re-sorts results after boost

**See:** src/tools/search/{text_search.rs, formatting.rs, mod.rs, scoring.rs}, src/search/{index.rs, query.rs, scoring.rs}
